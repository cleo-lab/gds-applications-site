
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Machine learning &#8212; Geospatial Data Science Applications</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Project ideas" href="project-ideas.html" />
    <link rel="prev" title="Machine learning lecture" href="../../lectures/week5/lecture-5.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/uo_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Geospatial Data Science Applications</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to Geospatial Data Science Applications 2023!
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course information
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../course-info/general-info.html">
   General information
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course-info/schedule.html">
   Schedule (for Winter 2022)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course-info/python.html">
   Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course-info/github.html">
   GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course-info/slack.html">
   Slack
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../course-info/final-project.html">
   Final projects
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/week1/lab1a-demo.html">
   Getting started with Python and GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/week1/lab1b-demo.html">
   Instructions for submitting assignments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week1/assignment1.html">
   Assignment 1
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week2/assignment2.html">
   Assignment 1
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 3
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../week3/lab3-demo.html">
   Network data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 4
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/week4/lecture-4.html">
   Gridded data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week4/assignment4.html">
   Assignment 1
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 5
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/week5/lecture-5.html">
   Machine learning lecture
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Machine learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="project-ideas.html">
   Project ideas
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 6
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/week6/lecture-6.html">
   Code management lecture
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week6/lab6-demo.html">
   Collaborating on GitHub
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 7
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/week7/lecture-7.html">
   Data access lecture
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week7/lab7-demo.html">
   Data access
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Week 8
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../lectures/week8/lecture-8.html">
   Visualization lecture
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/labs/week5/lab5-demo.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/owel-lab/gds-applications-site"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/owel-lab/gds-applications-site/issues/new?title=Issue%20on%20page%20%2Flabs/week5/lab5-demo.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/owel-lab/gds-applications-site/main?urlpath=tree/book/labs/week5/lab5-demo.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-for-any-updates-in-course-materials">
   Check for any updates in course materials
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data-for-the-lab">
     Download the data for the lab
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-new-environment-and-launch-the-notebook">
     Create a new environment and launch the notebook
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-engineering">
   Feature engineering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlation-matrix">
   Correlation matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fit-a-model-to-data">
   Fit a model to data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluate-model">
   Evaluate model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#it-s-competition-time">
   It’s competition time!
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-1-10-points">
   Question 1 (10 points):
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-2-30-points">
   Question 2 (30 points):
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#task-1-10-points">
   Task 1 (10 points):
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remember-to-submit-your-answers-to-questions-1-and-2-and-complete-task-1-by-friday-11-59pm">
   Remember to submit your answers to Questions 1 and 2 and complete Task 1
   <strong>
    by Friday 11:59pm
   </strong>
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Machine learning</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#check-for-any-updates-in-course-materials">
   Check for any updates in course materials
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data-for-the-lab">
     Download the data for the lab
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-new-environment-and-launch-the-notebook">
     Create a new environment and launch the notebook
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-engineering">
   Feature engineering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correlation-matrix">
   Correlation matrix
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fit-a-model-to-data">
   Fit a model to data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluate-model">
   Evaluate model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#it-s-competition-time">
   It’s competition time!
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-1-10-points">
   Question 1 (10 points):
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-2-30-points">
   Question 2 (30 points):
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#task-1-10-points">
   Task 1 (10 points):
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remember-to-submit-your-answers-to-questions-1-and-2-and-complete-task-1-by-friday-11-59pm">
   Remember to submit your answers to Questions 1 and 2 and complete Task 1
   <strong>
    by Friday 11:59pm
   </strong>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="machine-learning">
<h1>Machine learning<a class="headerlink" href="#machine-learning" title="Permalink to this headline">¶</a></h1>
<p><strong>Objectives:</strong></p>
<ul class="simple">
<li><p>Engineer some features for better prediction of California house prices</p></li>
<li><p>Train a machine learning model using <code>scikit-learn</code></p></li>
<li><p>Evaluate our machine learning model</p></li>
</ul>
<div class="section" id="check-for-any-updates-in-course-materials">
<h2>Check for any updates in course materials<a class="headerlink" href="#check-for-any-updates-in-course-materials" title="Permalink to this headline">¶</a></h2>
<p>Before we start this assignment, we need to check whether there are any updates to the original course repository. We can do this by adding the original repository (the one we forked) as a <em>remote</em>. Command line users can do this by running:</p>
<p><code>git fetch upstream</code></p>
<p><code>git merge upstream/master master</code></p>
<p>GitHub Desktop users should first click the <strong>Fetch origin</strong> button to check for new changes. Then click the triangle symbol next to <strong>Current branch: master</strong>, click <strong>Choose a branch to merge into master</strong>, click <strong>upstream/master</strong> from <strong>Other branches</strong> and click <strong>Create a merge commit</strong>.</p>
<p>Any new updates to the course repository will now be available in your local repository.</p>
<div class="section" id="download-the-data-for-the-lab">
<h3>Download the data for the lab<a class="headerlink" href="#download-the-data-for-the-lab" title="Permalink to this headline">¶</a></h3>
<p>We will be using the California housing data which is available on Dropbox (see Slack or Canvas for link). Download <code class="docutils literal notranslate"><span class="pre">lab5/california_house_prices.csv</span></code> and <code class="docutils literal notranslate"><span class="pre">california_coastline.shp</span></code> to your local machine.</p>
<p>A description of the dataset can be found <a class="reference external" href="https://developers.google.com/machine-learning/crash-course/california-housing-data-description">here</a></p>
</div>
<div class="section" id="create-a-new-environment-and-launch-the-notebook">
<h3>Create a new environment and launch the notebook<a class="headerlink" href="#create-a-new-environment-and-launch-the-notebook" title="Permalink to this headline">¶</a></h3>
<p>As always, make a new environment that contains all the packages for this lab. Navigate to the <code class="docutils literal notranslate"><span class="pre">labs/lab5</span></code> folder (either from the terminal for Linux and Mac users or from the <strong>CMD.exe Prompt</strong> launched from <strong>Anaconda Navigator</strong> for Windows users) and run:</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment.yml</span></code></p>
<p>Activate this environment by running:</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">lab5</span></code></p>
<p>Now launch the lab demo notebook (if you haven’t already): <a class="reference external" href="https://nbviewer.org/github/JohnnyRyan1/geospatial-data-science/blob/master/labs/lab5/lab5_demo.ipynb">https://nbviewer.org/github/JohnnyRyan1/geospatial-data-science/blob/master/labs/lab5/lab5_demo.ipynb</a></p>
<p>Now we are ready to start…</p>
</div>
</div>
<div class="section" id="feature-engineering">
<h2>Feature engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline">¶</a></h2>
<p>The most important part of data science is generating new features that have predictive power. We just used the default variables for predicting house prices in the lecture but there are other factors that may be useful.</p>
<p>For example, we often have <strong>geolocation data</strong>, which could be very useful for house price prediction task. In this demo we will engineer some new features to improve the accuracy of our house price prediction model.</p>
<p>As a recap, these were the mean-sqaured-errors from the lecture demo:</p>
<ul class="simple">
<li><p>Multiple linear regression: $64,374</p></li>
<li><p>Decision Tree: $82,290</p></li>
<li><p>RandomForests: $60,264</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/home/johnny/Dropbox (University of Oregon)/Teaching/geospatial-data-science/data/lab5/california_house_prices.csv&#39;</span><span class="p">)</span>

<span class="c1"># Read dataset</span>
<span class="n">coast</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;/home/johnny/Dropbox (University of Oregon)/Teaching/geospatial-data-science/data/lab5/california_coastline.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert DataFrame to GeoDataFrame</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]))</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">set_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">,</span> <span class="n">allow_override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Reproject everything to UTM 10N (EPSG:32610)</span>
<span class="n">gdf_utm</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:32610&#39;</span><span class="p">)</span>
<span class="n">coast_utm</span> <span class="o">=</span> <span class="n">coast</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;EPSG:32610&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute distance to coast</span>
<span class="n">distance_to_coast</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gdf_utm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">distance_to_coast</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coast_utm</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    
<span class="c1"># Add to DataFrame</span>
<span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;distance_to_coast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_to_coast</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quickly check that it worked!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;distance_to_coast&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f97ff7576a0&gt;
</pre></div>
</div>
<img alt="../../_images/lab5-demo_9_1.png" src="../../_images/lab5-demo_9_1.png" />
</div>
</div>
</div>
<div class="section" id="correlation-matrix">
<h2>Correlation matrix<a class="headerlink" href="#correlation-matrix" title="Permalink to this headline">¶</a></h2>
<p>We will perform another correlation matrix to see if <code class="docutils literal notranslate"><span class="pre">distance_to_coast</span></code> is useful predictor of <code class="docutils literal notranslate"><span class="pre">median_house_value</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute correlation matrix</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">gdf_utm</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Display just house value correlations</span>
<span class="n">corr_matrix</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median_house_value    1.000000
median_income         0.668566
total_rooms           0.152923
households            0.098525
total_bedrooms        0.079023
population            0.020930
housing_median_age    0.014355
longitude            -0.020092
latitude             -0.173908
distance_to_coast    -0.505078
Name: median_house_value, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>It is the second most correlated variable with <code class="docutils literal notranslate"><span class="pre">median_house_value</span></code>, excellent!</p>
<p>There are still some features that could be improved. For example, <code class="docutils literal notranslate"><span class="pre">total_rooms</span></code> and <code class="docutils literal notranslate"><span class="pre">total_bedrooms</span></code> does not mean much because it just depends on the number of house in the block group. A more useful metric would be <strong>rooms per house</strong> or <strong>bedrooms per house</strong>.</p>
<p>We can add those columns pretty simply</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rooms per house</span>
<span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;rooms_per_house&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;total_rooms&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;households&#39;</span><span class="p">]</span>

<span class="c1"># Bedrooms per house</span>
<span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;total_bedrooms&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;total_rooms&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute correlation matrix</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">gdf_utm</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Display just house value correlations</span>
<span class="n">corr_matrix</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median_house_value    1.000000
median_income         0.668566
total_rooms           0.152923
rooms_per_house       0.113277
households            0.098525
total_bedrooms        0.079023
population            0.020930
housing_median_age    0.014355
longitude            -0.020092
latitude             -0.173908
bedrooms_per_room    -0.233964
distance_to_coast    -0.505078
Name: median_house_value, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The new <code class="docutils literal notranslate"><span class="pre">bedrooms_per_room</span></code> attribute is more correlated with <code class="docutils literal notranslate"><span class="pre">median_house_value</span></code> than the <code class="docutils literal notranslate"><span class="pre">total_rooms</span></code> or <code class="docutils literal notranslate"><span class="pre">total_bedrooms</span></code>. Apparently houses with a lower bedroom/room ratio tend to be more expensive.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rooms_per_house</span></code> is surprisingly not that well correlated with <code class="docutils literal notranslate"><span class="pre">median_house_value</span></code>. Location is clearly the most important thing in the California housing market!</p>
</div>
<div class="section" id="fit-a-model-to-data">
<h2>Fit a model to data<a class="headerlink" href="#fit-a-model-to-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define feature list</span>
<span class="n">feature_list</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;distance_to_coast&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;total_rooms&#39;</span><span class="p">,</span> <span class="s1">&#39;rooms_per_house&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;households&#39;</span><span class="p">]</span>

<span class="c1"># Define features and labels </span>
<span class="n">X</span> <span class="o">=</span> <span class="n">gdf_utm</span><span class="p">[</span><span class="n">feature_list</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">gdf_utm</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>

<span class="c1"># Standarize data</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>  
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split data </span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define model</span>
<span class="n">forest_reg</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># Fit model</span>
<span class="n">forest_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RandomForestRegressor(n_estimators=30)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evaluate-model">
<h2>Evaluate model<a class="headerlink" href="#evaluate-model" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict test labels predictions</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">forest_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Compute mean-squared-error</span>
<span class="n">final_mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span> <span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">final_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">final_mse</span><span class="p">)</span>
<span class="n">final_rmse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>56114.57594259003
</pre></div>
</div>
</div>
</div>
<p>So we improved our model by around $4,000. This might not sound like much but could make a big difference to someone and might the difference between winning a <a class="reference external" href="https://www.kaggle.com/">Kaggle</a> competition or not.</p>
</div>
<div class="section" id="it-s-competition-time">
<h2>It’s competition time!<a class="headerlink" href="#it-s-competition-time" title="Permalink to this headline">¶</a></h2>
<p>In this week’s lab we will play a Kaggle-like competition. In these competitions, a host usually prepares a dataset and people from around the world compete against each other to produce the best model. Submitted models are scored based on their predictive accuracy relative to a hidden solution file.</p>
<p>We will be competing to produce the most accurate model for predicting house prices in Seattle. The dataset can be downloaded from the Dropbox link provided on Slack or Canvas.</p>
</div>
<hr class="docutils" />
<div class="section" id="question-1-10-points">
<h2>Question 1 (10 points):<a class="headerlink" href="#question-1-10-points" title="Permalink to this headline">¶</a></h2>
<p>To start, make a <strong>new</strong> <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code> called <code class="docutils literal notranslate"><span class="pre">lab5_submission.ipynb</span></code> and work through the following tasks.</p>
<p>The first task is answer the following questions using some of the methods we have covered in the lecture/demo.</p>
<ul class="simple">
<li><p>How many houses are in this dataset?</p></li>
<li><p>How many <strong>features</strong> are there for predicting house price?</p></li>
<li><p>Are there any null values in this dataset?</p></li>
<li><p>Which three variables are best correlated with house price (include correlation coefficients)?</p></li>
<li><p>Which three variables are least correlated with house price (include correlation coefficients)?</p></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="question-2-30-points">
<h2>Question 2 (30 points):<a class="headerlink" href="#question-2-30-points" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Produce a model to predict house prices. You are welcome to generate new features, scale the data, and split the data into training/testing (i.e. <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>) in any way you like.</p></li>
<li><p>Evaluate your model’s accuracy by predicting a test dataset, for example:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">predictions</span> <span class="pre">=</span> <span class="pre">forest_reg.predict(X_test)</span> <span class="pre">final_mse</span> <span class="pre">=</span> <span class="pre">mean_squared_error(y_test,</span> <span class="pre">predictions)</span> <span class="pre">final_rmse</span> <span class="pre">=</span> <span class="pre">np.sqrt(final_mse)</span></code></p>
<ul class="simple">
<li><p>Push your <code class="docutils literal notranslate"><span class="pre">lab5_submission.ipynb</span></code> to GitHub and submit a <code class="docutils literal notranslate"><span class="pre">.pdf</span></code> version to Canvas</p></li>
<li><p>On <strong>Monday</strong> the instructor and TA will provide an <strong>unseen set of houses</strong> which students will use to repeat their accuracy evaluation. The best models (i.e. lowest RMSE) will win prizes.</p></li>
<li><p>We will evaluate the models using a simple <code class="docutils literal notranslate"><span class="pre">mean-squared-error</span></code> as follows:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">mse</span> <span class="pre">=</span> <span class="pre">mean_squared_error(y_test</span> <span class="pre">,</span> <span class="pre">predictions)</span> <span class="pre">rmse</span> <span class="pre">=</span> <span class="pre">np.sqrt(final_mse)</span></code></p>
</div>
<hr class="docutils" />
<div class="section" id="task-1-10-points">
<h2>Task 1 (10 points):<a class="headerlink" href="#task-1-10-points" title="Permalink to this headline">¶</a></h2>
<p>Submit a project idea to the <code class="docutils literal notranslate"><span class="pre">#final-projects</span></code> channel on <strong>Slack</strong>. See: <a class="reference external" href="https://github.com/JohnnyRyan1/geospatial-data-science/blob/master/labs/lab5/project_ideas_task.md">https://github.com/JohnnyRyan1/geospatial-data-science/blob/master/labs/lab5/project_ideas_task.md</a> for more details.</p>
</div>
<div class="section" id="remember-to-submit-your-answers-to-questions-1-and-2-and-complete-task-1-by-friday-11-59pm">
<h2>Remember to submit your answers to Questions 1 and 2 and complete Task 1 <strong>by Friday 11:59pm</strong><a class="headerlink" href="#remember-to-submit-your-answers-to-questions-1-and-2-and-complete-task-1-by-friday-11-59pm" title="Permalink to this headline">¶</a></h2>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./labs/week5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../../lectures/week5/lecture-5.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Machine learning lecture</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="project-ideas.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Project ideas</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Johnny Ryan<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>